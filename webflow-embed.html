<!-- Webflow Custom Code Embed - Cabinet Generator Form -->
<!-- Paste this entire code into Webflow's Embed element -->

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
  rel="stylesheet"
/>

<style>
  :root {
    --primary-color: #191970;
    --primary-color-hover: #0f0f4d;
  }

  #cabinet-generator-wrapper {
    font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
      "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans",
      "Helvetica Neue", sans-serif;
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
  }

  #cabinet-generator-wrapper * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    border-radius: 24px;
  }

  #cabinet-generator-wrapper .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-auto-rows: 1fr;
    gap: 0;
    background: white;
  }

  #cabinet-generator-wrapper .left-panel {
    background: #f9fafb;
    border-radius: 0;
    padding: 40px;
    border-right: 1px solid #e5e7eb;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  #cabinet-generator-wrapper .upload-area {
    width: 100%;
    max-width: 500px;
    height: 500px;
    border: 2px dashed #d1d5db;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    background: white;
    position: relative;
    overflow: hidden;
  }

  #cabinet-generator-wrapper .upload-area:hover {
    border-color: var(--primary-color);
    background: #f9fafb;
  }

  #cabinet-generator-wrapper .upload-area.has-image {
    border-style: solid;
  }

  #cabinet-generator-wrapper .upload-icon {
    width: 64px;
    height: 64px;
    margin-bottom: 16px;
  }

  #cabinet-generator-wrapper .upload-text {
    font-size: 16px;
    color: var(--primary-color);
    font-weight: 500;
    margin-bottom: 4px;
  }

  #cabinet-generator-wrapper .upload-subtext {
    font-size: 14px;
    color: #6b7280;
  }

  #cabinet-generator-wrapper .preview-image {
    display: none;
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 20px;
  }

  #cabinet-generator-wrapper .upload-area.has-image .preview-image {
    display: block;
  }

  #cabinet-generator-wrapper .upload-area.has-image .upload-content {
    display: none;
  }

  #cabinet-generator-wrapper .right-panel {
    padding: 40px;
    overflow-y: auto;
  }

  #cabinet-generator-wrapper .form-section {
    margin-bottom: 32px;
  }

  #cabinet-generator-wrapper .form-section:last-child {
    margin-bottom: 0;
  }

  #cabinet-generator-wrapper .section-label {
    font-size: 16.8px;
    font-weight: 600;
    color: #111827;
    margin-bottom: 12px;
    display: block;
  }

  #cabinet-generator-wrapper .options-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  #cabinet-generator-wrapper .option-pill {
    padding: 10px 20px;
    border: 1.5px solid #d1d5db;
    border-radius: 24px;
    background: white;
    color: #6b7280;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  #cabinet-generator-wrapper .option-pill:hover {
    border-color: #9ca3af;
  }

  #cabinet-generator-wrapper .option-pill.selected {
    background: var(--primary-color);
    border-color: var(--primary-color);
    color: white;
  }

  #cabinet-generator-wrapper .color-options {
    display: flex;
    gap: 16px;
    align-items: flex-start;
    flex-wrap: wrap;
  }

  #cabinet-generator-wrapper .color-option-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  #cabinet-generator-wrapper .color-circle {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #d1d5db;
    transition: all 0.2s;
    position: relative;
  }

  #cabinet-generator-wrapper .color-circle:hover {
    transform: scale(1.1);
  }

  #cabinet-generator-wrapper .color-circle.selected {
    border-color: var(--primary-color);
    border-width: 3px;
    box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary-color);
  }

  #cabinet-generator-wrapper .color-name {
    font-size: 12px;
    color: #6b7280;
    font-weight: 500;
    text-align: center;
    max-width: 70px;
  }

  #cabinet-generator-wrapper .color-option-wrapper.selected .color-name {
    color: var(--primary-color);
    font-weight: 600;
  }

  #cabinet-generator-wrapper .create-button {
    width: 100%;
    padding: 16px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 40px;
    transition: all 0.2s;
  }

  #cabinet-generator-wrapper .create-button:hover:not(:disabled) {
    background: var(--primary-color-hover);
  }

  #cabinet-generator-wrapper .create-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  #cabinet-generator-wrapper .loading-spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 0.8s linear infinite;
    margin-right: 8px;
    vertical-align: middle;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  .result-modal {
    display: none !important;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    align-items: center;
    justify-content: center;
  }

  .result-modal.show {
    display: flex !important;
  }

  .result-modal .result-content {
    background: white;
    padding: 40px;
    border-radius: 12px;
    max-width: 90%;
    max-height: 90%;
    overflow: auto;
    position: relative;
  }

  .result-modal .result-image {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }

  .result-modal .close-modal {
    position: absolute;
    top: 12px;
    right: 12px;
    background: #e5e7eb;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    cursor: pointer;
    font-size: 20px;
    line-height: 1;
    color: #6b7280;
  }

  .result-modal .close-modal:hover {
    background: #d1d5db;
  }

  #cabinet-generator-wrapper .error-message {
    margin-top: 16px;
    padding: 12px;
    background: #fef2f2;
    border: 1px solid #fecaca;
    border-radius: 8px;
    color: #dc2626;
    font-size: 14px;
    display: none;
  }

  #cabinet-generator-wrapper .error-message.show {
    display: block;
  }

  #cabinet-generator-wrapper #fileInput {
    display: none;
  }

  /* Progress Bar */
  #cabinet-generator-wrapper .progress-section {
    display: none;
    padding: 60px 40px;
    text-align: center;
  }

  #cabinet-generator-wrapper .progress-section.show {
    display: block;
  }

  #cabinet-generator-wrapper .right-panel.generating .progress-section {
    display: block;
  }

  #cabinet-generator-wrapper .right-panel.generating #formSections,
  #cabinet-generator-wrapper .right-panel.generating .create-button,
  #cabinet-generator-wrapper .right-panel.generating .error-message {
    display: none;
  }

  #cabinet-generator-wrapper .progress-title {
    font-size: 24px;
    font-weight: 700;
    color: #111827;
    margin-bottom: 12px;
  }

  #cabinet-generator-wrapper .progress-message {
    font-size: 16px;
    color: #6b7280;
    margin-bottom: 40px;
  }

  #cabinet-generator-wrapper .progress-bar-container {
    width: 100%;
    max-width: 400px;
    height: 12px;
    background: #e5e7eb;
    border-radius: 6px;
    overflow: hidden;
    margin: 0 auto 16px;
    position: relative;
  }

  #cabinet-generator-wrapper .progress-bar-fill {
    height: 100%;
    background: var(--primary-color);
    border-radius: 6px;
    width: 0%;
    transition: width 0.3s ease;
  }

  #cabinet-generator-wrapper .progress-percentage {
    font-size: 48px;
    font-weight: 700;
    color: var(--primary-color);
    margin: 20px 0;
  }

  #cabinet-generator-wrapper .progress-stage {
    font-size: 16px;
    color: #6b7280;
    margin-top: 12px;
    min-height: 24px;
  }

  /* Image Comparison Slider */
  #cabinet-generator-wrapper .comparison-container {
    display: none;
    width: 100%;
    margin: 40px 0 0;
    padding: 40px;
    background: white;
  }

  #cabinet-generator-wrapper .comparison-container.show {
    display: block;
  }

  #cabinet-generator-wrapper .comparison-content-wrapper {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 48px;
    align-items: center;
  }

  #cabinet-generator-wrapper .comparison-left {
    flex: 1;
  }

  #cabinet-generator-wrapper .benefits-section {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  #cabinet-generator-wrapper .benefit-item {
    display: flex;
    gap: 16px;
    align-items: flex-start;
  }

  #cabinet-generator-wrapper .benefit-icon {
    flex-shrink: 0;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
    font-weight: bold;
  }

  #cabinet-generator-wrapper .benefit-text {
    flex: 1;
  }

  #cabinet-generator-wrapper .benefit-text strong {
    display: block;
    font-size: 16px;
    font-weight: 600;
    color: #111827;
    margin-bottom: 4px;
  }

  #cabinet-generator-wrapper .benefit-text p {
    font-size: 14px;
    color: #6b7280;
    line-height: 1.5;
  }

  #cabinet-generator-wrapper .comparison-title {
    font-size: 24px;
    font-weight: 700;
    color: #111827;
    margin-bottom: 24px;
    text-align: center;
  }

  #cabinet-generator-wrapper .image-comparison-slider {
    position: relative;
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    overflow: hidden;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  #cabinet-generator-wrapper .comparison-image {
    display: block;
    width: 100%;
    user-select: none;
    pointer-events: none;
  }

  #cabinet-generator-wrapper .image-after {
    display: block;
  }

  #cabinet-generator-wrapper .image-before {
    position: absolute;
    height: 100%;
    width: 50%;
    top: 0;
    left: 0;
    overflow: hidden;
    z-index: 2;
  }

  #cabinet-generator-wrapper .image-before .comparison-image {
    position: absolute;
    height: 100%;
    width: auto;
    max-width: none;
    left: 0;
    top: 0;
  }

  #cabinet-generator-wrapper .slider-handle {
    position: absolute;
    display: flex;
    align-items: center;
    z-index: 5;
    top: 0;
    left: 50%;
    height: 100%;
    width: 4px;
    background: white;
    cursor: ew-resize;
    -ms-touch-action: pan-y;
    touch-action: pan-y;
  }

  #cabinet-generator-wrapper .slider-handle::after {
    content: "⇄";
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    color: white;
    position: absolute;
    margin: 0 0 0 -22px;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--primary-color);
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  #cabinet-generator-wrapper .slider-handle.resize {
    cursor: ew-resize;
  }

  #cabinet-generator-wrapper .comparison-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 16px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  #cabinet-generator-wrapper .label {
    font-size: 14px;
    font-weight: 600;
    color: #6b7280;
    padding: 8px 16px;
    background: #f3f4f6;
    border-radius: 6px;
  }

  #cabinet-generator-wrapper .comparison-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 32px;
  }

  #cabinet-generator-wrapper .action-button {
    padding: 14px 32px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
  }

  #cabinet-generator-wrapper .download-button {
    background: var(--primary-color);
    color: white;
  }

  #cabinet-generator-wrapper .download-button:hover {
    background: var(--primary-color-hover);
  }

  #cabinet-generator-wrapper .reset-button {
    background: white;
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
  }

  #cabinet-generator-wrapper .reset-button:hover {
    background: #f0f7ff;
  }

  @media (max-width: 1024px) {
    #cabinet-generator-wrapper .form-grid {
      grid-template-columns: 1fr;
      grid-auto-rows: auto;
    }

    #cabinet-generator-wrapper .left-panel {
      border-right: none;
      border-bottom: 1px solid #e5e7eb;
      padding: 30px 20px;
    }

    #cabinet-generator-wrapper .upload-area {
      max-width: 400px;
      height: 400px;
    }

    #cabinet-generator-wrapper .right-panel {
      padding: 30px 20px;
    }

    #cabinet-generator-wrapper .comparison-content-wrapper {
      grid-template-columns: 1fr;
      gap: 32px;
    }

    #cabinet-generator-wrapper .benefits-section {
      order: 2;
    }

    #cabinet-generator-wrapper .comparison-left {
      order: 1;
    }
  }

  @media (max-width: 768px) {
    #cabinet-generator-wrapper .left-panel {
      padding: 20px;
    }

    #cabinet-generator-wrapper .upload-area {
      max-width: 100%;
      height: 250px;
    }

    #cabinet-generator-wrapper .upload-icon {
      width: 48px;
      height: 48px;
    }

    #cabinet-generator-wrapper .upload-text {
      font-size: 14px;
    }

    #cabinet-generator-wrapper .upload-subtext {
      font-size: 12px;
    }

    #cabinet-generator-wrapper .right-panel {
      padding: 20px;
    }

    #cabinet-generator-wrapper .form-section {
      margin-bottom: 24px;
    }

    #cabinet-generator-wrapper .section-label {
      font-size: 15.6px;
      margin-bottom: 10px;
    }

    #cabinet-generator-wrapper .option-pill {
      padding: 8px 16px;
      font-size: 13px;
    }

    #cabinet-generator-wrapper .color-circle {
      width: 40px;
      height: 40px;
    }

    #cabinet-generator-wrapper .color-options {
      gap: 10px;
    }

    #cabinet-generator-wrapper .create-button {
      margin-top: 30px;
      padding: 14px;
      font-size: 15px;
    }
  }

  @media (max-width: 480px) {
    #cabinet-generator-wrapper .left-panel {
      padding: 16px;
    }

    #cabinet-generator-wrapper .upload-area {
      height: 200px;
    }

    #cabinet-generator-wrapper .upload-icon {
      width: 40px;
      height: 40px;
      margin-bottom: 12px;
    }

    #cabinet-generator-wrapper .upload-text {
      font-size: 13px;
    }

    #cabinet-generator-wrapper .upload-subtext {
      font-size: 11px;
    }

    #cabinet-generator-wrapper .right-panel {
      padding: 16px;
    }

    #cabinet-generator-wrapper .form-section {
      margin-bottom: 20px;
    }

    #cabinet-generator-wrapper .section-label {
      font-size: 14.4px;
      margin-bottom: 8px;
    }

    #cabinet-generator-wrapper .options-grid {
      gap: 6px;
    }

    #cabinet-generator-wrapper .option-pill {
      padding: 7px 14px;
      font-size: 12px;
    }

    #cabinet-generator-wrapper .color-circle {
      width: 36px;
      height: 36px;
    }

    #cabinet-generator-wrapper .color-circle[data-color="#FFFFFF"]::after {
      font-size: 16px;
    }

    #cabinet-generator-wrapper .color-options {
      gap: 8px;
      flex-wrap: wrap;
    }

    #cabinet-generator-wrapper .create-button {
      margin-top: 24px;
      padding: 12px;
      font-size: 14px;
      border-radius: 6px;
    }
  }
</style>

<div id="cabinet-generator-wrapper">
  <div class="form-grid">
    <div class="left-panel">
      <div class="upload-area" id="uploadArea">
        <div class="upload-content">
          <svg
            class="upload-icon"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            style="color: var(--primary-color)"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"
            ></path>
          </svg>
          <div class="upload-text">Browse</div>
          <div class="upload-subtext">Support all image format</div>
        </div>
        <img class="preview-image" id="previewImage" alt="Preview" />
      </div>
      <input type="file" id="fileInput" accept="image/*" />
    </div>

    <div class="right-panel" id="rightPanel">
      <form id="cabinetForm">
        <div id="formSections"></div>
        <button type="submit" class="create-button" id="createButton">
          Visualiseer
        </button>
        <div class="error-message" id="errorMessage"></div>
      </form>

      <div class="progress-section" id="progressSection">
        <h3 class="progress-title">Generating Your Cabinet</h3>
        <p class="progress-message">
          Please wait while we create your custom design...
        </p>
        <div class="progress-percentage" id="progressPercentage">0%</div>
        <div class="progress-bar-container">
          <div class="progress-bar-fill" id="progressBarFill"></div>
        </div>
        <div class="progress-stage" id="progressStage">Initializing...</div>
      </div>
    </div>
  </div>

  <!-- Image Comparison Slider -->
  <div class="comparison-container" id="comparisonContainer">
    <h2 class="comparison-title">
      Ontdek de potentie van je ruimte: Voor & Na
    </h2>
    <div class="comparison-content-wrapper">
      <div class="comparison-left">
        <div class="image-comparison-slider" id="imageComparisonSlider">
          <div class="image-before" id="imageBefore">
            <img
              class="comparison-image"
              id="beforeImage"
              alt="Original Image"
            />
          </div>
          <div class="image-after" id="imageAfter">
            <img
              class="comparison-image"
              id="afterImage"
              alt="Generated Image"
            />
          </div>
          <div class="slider-handle" id="sliderHandle"></div>
        </div>
        <div class="comparison-labels">
          <span class="label">Gevisualiseerd door AI</span>
          <span class="label">Originele foto</span>
        </div>
        <div class="comparison-actions">
          <button class="action-button download-button" id="downloadButton">
            Resultaat downloaden
          </button>
          <button class="action-button reset-button" id="resetButton">
            Opnieuw genereren
          </button>
        </div>
      </div>

      <div class="benefits-section">
        <div class="benefit-item">
          <div class="benefit-icon">✓</div>
          <div class="benefit-text">
            <strong>Volledig op maat gemaakt</strong>
            <p>
              Benut je ruimte optimaal met een ontwerp dat perfect past bij jouw
              behoeften.
            </p>
          </div>
        </div>

        <div class="benefit-item">
          <div class="benefit-icon">✓</div>
          <div class="benefit-text">
            <strong>Duurzame kwaliteit</strong>
            <p>Gemaakt van 18mm multiplex: oersterk, slijtvast en duurzaam.</p>
          </div>
        </div>

        <div class="benefit-item">
          <div class="benefit-icon">✓</div>
          <div class="benefit-text">
            <strong>Vlot proces</strong>
            <p>Offerte in 24u, ontwerp in 2 weken, geleverd in 10–14 weken.</p>
          </div>
        </div>

        <div class="benefit-item">
          <div class="benefit-icon">✓</div>
          <div class="benefit-text">
            <strong>Eerlijke prijs</strong>
            <p>
              Rechtstreeks uit de fabriek, zonder tussenhandel. Luxe kwaliteit
              voor een scherpe prijs.
            </p>
          </div>
        </div>

        <div class="benefit-item">
          <div class="benefit-icon">✓</div>
          <div class="benefit-text">
            <strong>Montage naar wens</strong>
            <p>
              Zelf monteren voor de beste prijs, of volledig laten installeren
              voor totaal gemak.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Result Modal -->
<div class="result-modal" id="resultModal">
  <div class="result-content">
    <button class="close-modal" id="closeModal">&times;</button>
    <img class="result-image" id="resultImage" alt="Generated Image" />
  </div>
</div>

<script>
  (function () {
    // API Configuration
    const API_BASE_URL = "https://knapkast-express-api.vercel.app";

    // const API_BASE_URL = "http://localhost:3000";

    // Form configuration with composite data structure
    const formConfig = {
      sections: [
        {
          id: "kasttype",
          label: "Kies een kasttype",
          type: "pills",
          options: [
            {
              id: 0,
              name: "Boekkast",
              prompt:
                "a custom built-in bookcase cabinet with many open shelves, a few closed cabinets at the bottom, styled with books and decor objects",
            },
            {
              id: 1,
              name: "Wandkast",
              prompt:
                "a wall-to-wall living room cabinet with a TV niche in the center, closed cabinets below and asymmetrical open shelves around",
            },
            {
              id: 2,
              name: "Bijkeuken",
              prompt:
                "a utility room cabinet set with tall storage for cleaning tools, overhead cupboards, and open shelves for laundry baskets",
            },
            {
              id: 3,
              name: "Kledingkast",
              prompt:
                "a floor-to-ceiling wardrobe cabinet with tall doors, internal hanging rails, drawers, and a few open niches for display",
            },
            {
              id: 4,
              name: "Bureaukast",
              prompt:
                "a home office cabinet with a built-in desk in the middle, shelves above, and closed storage on both sides",
            },
            {
              id: 5,
              name: "Gangkast",
              prompt:
                "a hallway storage cabinet with a bench, open coat hooks, cubbies for shoes and a few tall doors for hidden storage",
            },
          ],
        },

        // SPACE = how it is fitted in the room
        {
          id: "space",
          label: "Space",
          type: "pills",
          options: [
            {
              id: 0,
              name: "Floor to Ceiling",
              prompt:
                "built wall-to-wall and floor-to-ceiling, fully fitted with no gaps",
            },
            {
              id: 1,
              name: "Loose",
              prompt:
                "as a freestanding cabinet with visible side panels and a light plinth or slim legs",
            },
            {
              id: 2,
              name: "Nis / Recessed",
              prompt:
                "built into a recessed wall niche, perfectly filling the opening from side to side",
            },
            {
              id: 3,
              name: "Hoekopstelling",
              prompt:
                "as an L-shaped corner cabinet using two walls, wrapping neatly around the corner",
            },
            {
              id: 4,
              name: "Rondom raam",
              prompt:
                "built around a window, with storage on both sides and cabinets or shelves above the window",
            },
            {
              id: 5,
              name: "Floating cabinet",
              prompt:
                "floating above the floor, wall-mounted with no visible support or plinth",
            },
          ],
        },

        // COLORS = more varied palette
        {
          id: "colors",
          label: "Colors",
          type: "color-circles",
          options: [
            {
              id: 0,
              name: "Light Wood",
              color: "#D4A574",
              prompt: "in warm natural light oak wood with visible grain",
            },
            {
              id: 1,
              name: "Wood Stripes",
              color: "#C19A6B",
              prompt: "light brown with natural lightly striped",
            },
            {
              id: 2,
              name: "White",
              color: "#FFFFFF",
              prompt: "in matte white lacquer for a bright clean look",
            },
            {
              id: 3,
              name: "Beige",
              color: "#E8D5C4",
              prompt: "in soft beige with a warm, cozy feel",
            },
            {
              id: 4,
              name: "Grey",
              color: "#9CA3AF",
              prompt: "in light neutral grey",
            },
            {
              id: 5,
              name: "Dark Grey",
              color: "#4B5563",
              prompt: "in deep charcoal grey for a bold modern look",
            },
            {
              id: 6,
              name: "Mahogany",
              color: "#6B3410",
              prompt: "in rich dark mahogany wood with a classic upscale feel",
            },
            {
              id: 7,
              name: "Black",
              color: "#111827",
              prompt: "in deep matte black for a dramatic designer look",
            },

            {
              id: 9,
              name: "Dark Walnut",
              color: "#5C3A21",
              prompt: "in dark walnut wood with a luxurious atmosphere",
            },
            {
              id: 10,
              name: "Sage Green",
              color: "#4B6B4F",
              prompt: "in muted sage green for a calm natural look",
            },
            {
              id: 11,
              name: "Dusty Blue",
              color: "#3B6BA5",
              prompt: "in dusty blue for a soft, slightly playful look",
            },
          ],
        },

        // VIBE = actual style families (multi-select)
        {
          id: "vibe",
          label: "Stijl / Vibe",
          type: "pills",
          multiSelect: true,
          options: [
            {
              id: 0,
              name: "Modern",
              prompt:
                "in a sleek modern style: flat slab fronts, thin shadow gaps, push-to-open doors and drawers, very clean lines",
            },
            {
              id: 1,
              name: "Nordic",
              prompt:
                "in a Nordic Scandinavian style: light wood, white fronts, simple geometry, soft minimalism and airy feeling",
            },
            {
              id: 2,
              name: "Farm",
              prompt:
                "in a modern farmhouse style: shaker panel doors, warm off-white and wood tones, chunky frames and black metal handles",
            },
            {
              id: 3,
              name: "Japandi",
              prompt:
                "in a Japandi style: calm neutral colors, natural wood, simple low-contrast details, very serene and minimal",
            },
            {
              id: 4,
              name: "Industrial",
              prompt:
                "in an industrial style: darker wood or black fronts, visible black metal accents, robust and slightly raw look",
            },
            {
              id: 5,
              name: "Panel Doors",
              prompt:
                "with modern French classic panel doors: slim shaker-style frames, subtle bevel details, soft off-white finish, and balanced elegant proportions inspired by Parisian apartments",
            },
          ],
        },

        // FUNCTIONALITY = what you do / how you use it (multi-select)
        {
          id: "functionality",
          label: "Functionality",
          type: "pills",
          multiSelect: true,
          options: [
            {
              id: 0,
              name: "Display shelf",
              prompt:
                "including a long open display shelf with see through doors zone for styling with books, plants and decor",
            },
            {
              id: 1,
              name: "Desk / Table",
              prompt:
                "including a built-in tabletop at desk height that can be used for working or folding clothes",
            },
            {
              id: 2,
              name: "LED lighting",
              prompt:
                "including integrated LED strip lighting in shelves and niches",
            },
            {
              id: 3,
              name: "Mirror dressing area",
              prompt:
                "including a tall mirrored door or panel for dressing use",
            },
            {
              id: 4,
              name: "Seating bench",
              prompt:
                "including a built-in seating bench, optionally with storage underneath",
            },
            {
              id: 5,
              name: "Pull-out laundry baskets",
              prompt:
                "including built-in pull-out laundry baskets in the lower section",
            },
            {
              id: 6,
              name: "Wardrobe hanging",
              prompt:
                "including a tall section with hanging rail for coats and clothes",
            },
            {
              id: 7,
              name: "Shoe storage",
              prompt:
                "including a dedicated shoe storage zone with low compartments or tilted shoe trays",
            },
          ],
        },

        // SPECS = physical specs of fronts & modules
        {
          id: "specs",
          label: "Specificaties",
          type: "pills",
          options: [
            {
              id: 0,
              name: "Handle doors",
              prompt:
                "with classic hinged doors and clearly visible handles on each door and drawer",
            },
            {
              id: 1,
              name: "Gripless doors",
              prompt:
                "with fully handleless fronts, push-to-open or finger pull details for a very clean look",
            },
            {
              id: 2,
              name: "Sliding doors",
              prompt:
                "with wide sliding doors that glide in front of the cabinet instead of hinged doors",
            },
            {
              id: 3,
              name: "Flipper doors",
              prompt:
                "with bi-fold flipper doors that fold outward and retract smoothly into the cabinet sidewalls, creating a fully open work zone",
            },
            {
              id: 4,
              name: "Glass doors",
              prompt:
                "with some glass-front display doors that reveal objects inside",
            },
            {
              id: 5,
              name: "Open shelves",
              prompt:
                "with many open shelves stacked in regular rhythm for visible storage and display",
            },
            {
              id: 6,
              name: "Many drawers",
              prompt:
                "with a full base section of deep drawers for organized closed storage",
            },
          ],
        },
      ],
    };

    // Selection state
    const selections = {
      kasttype: null,
      space: null,
      colors: null,
      vibe: [], // multi-select
      functionality: [], // multi-select
      specs: null,
      image: null,
    };

    // Generate form UI
    function renderForm() {
      const container = document.getElementById("formSections");
      container.innerHTML = "";

      formConfig.sections.forEach((section) => {
        const sectionDiv = document.createElement("div");
        sectionDiv.className = "form-section";

        const label = document.createElement("label");
        label.className = "section-label";
        label.textContent = section.label;
        sectionDiv.appendChild(label);

        if (section.type === "pills") {
          const optionsGrid = document.createElement("div");
          optionsGrid.className = "options-grid";

          section.options.forEach((option) => {
            const pill = document.createElement("button");
            pill.type = "button";
            pill.className = "option-pill";
            pill.textContent = option.name;
            pill.dataset.sectionId = section.id;
            pill.dataset.optionId = option.id;

            pill.addEventListener("click", () =>
              handlePillSelection(section.id, option.id, section.multiSelect)
            );
            optionsGrid.appendChild(pill);
          });

          sectionDiv.appendChild(optionsGrid);
        } else if (section.type === "color-circles") {
          const colorOptions = document.createElement("div");
          colorOptions.className = "color-options";

          section.options.forEach((option) => {
            const wrapper = document.createElement("div");
            wrapper.className = "color-option-wrapper";
            wrapper.dataset.sectionId = section.id;
            wrapper.dataset.optionId = option.id;

            const circle = document.createElement("div");
            circle.className = "color-circle";
            circle.style.backgroundColor = option.color;
            circle.dataset.color = option.color;
            circle.dataset.sectionId = section.id;
            circle.dataset.optionId = option.id;

            const colorName = document.createElement("div");
            colorName.className = "color-name";
            colorName.textContent = option.name;

            wrapper.addEventListener("click", () =>
              handleColorSelection(section.id, option.id)
            );

            wrapper.appendChild(circle);
            wrapper.appendChild(colorName);
            colorOptions.appendChild(wrapper);
          });

          sectionDiv.appendChild(colorOptions);
        }

        container.appendChild(sectionDiv);
      });
    }

    // Handle pill selection
    function handlePillSelection(sectionId, optionId, multiSelect) {
      if (multiSelect) {
        // Multi-select: toggle the option in the array
        const currentSelections = selections[sectionId];
        const index = currentSelections.indexOf(optionId);

        if (index === -1) {
          // Add to selection
          currentSelections.push(optionId);
        } else {
          // Remove from selection
          currentSelections.splice(index, 1);
        }

        // Update UI - toggle selected class
        const pill = document.querySelector(
          `[data-section-id="${sectionId}"][data-option-id="${optionId}"].option-pill`
        );
        if (pill) {
          pill.classList.toggle("selected");
        }
      } else {
        // Single select: replace selection
        selections[sectionId] = optionId;

        // Update UI - clear all and select one
        document
          .querySelectorAll(`[data-section-id="${sectionId}"].option-pill`)
          .forEach((pill) => {
            pill.classList.remove("selected");
          });

        const selectedPill = document.querySelector(
          `[data-section-id="${sectionId}"][data-option-id="${optionId}"]`
        );
        if (selectedPill) {
          selectedPill.classList.add("selected");
        }
      }

      updateCreateButton();
    }

    // Handle color selection
    function handleColorSelection(sectionId, optionId) {
      selections[sectionId] = optionId;

      // Update UI - remove selected from all wrappers and circles
      document
        .querySelectorAll(
          `[data-section-id="${sectionId}"].color-option-wrapper`
        )
        .forEach((wrapper) => {
          wrapper.classList.remove("selected");
          const circle = wrapper.querySelector(".color-circle");
          if (circle) circle.classList.remove("selected");
        });

      // Add selected to the chosen wrapper and circle
      const selectedWrapper = document.querySelector(
        `.color-option-wrapper[data-section-id="${sectionId}"][data-option-id="${optionId}"]`
      );
      if (selectedWrapper) {
        selectedWrapper.classList.add("selected");
        const circle = selectedWrapper.querySelector(".color-circle");
        if (circle) circle.classList.add("selected");
      }

      updateCreateButton();
    }

    // Image upload handling
    const uploadArea = document.getElementById("uploadArea");
    const fileInput = document.getElementById("fileInput");
    const previewImage = document.getElementById("previewImage");

    uploadArea.addEventListener("click", () => {
      fileInput.click();
    });

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file && file.type.startsWith("image/")) {
        handleImageUpload(file);
      }
    });

    // Drag and drop
    uploadArea.addEventListener("dragover", (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = "#2563EB";
    });

    uploadArea.addEventListener("dragleave", (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = "#d1d5db";
    });

    uploadArea.addEventListener("drop", (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = "#d1d5db";

      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith("image/")) {
        handleImageUpload(file);
      }
    });

    function handleImageUpload(file) {
      selections.image = file;

      const reader = new FileReader();
      reader.onload = (e) => {
        previewImage.src = e.target.result;
        selections.imageBase64 = e.target.result; // Store base64 data
        uploadArea.classList.add("has-image");
        updateCreateButton();
      };
      reader.readAsDataURL(file);
    }

    // Update create button state
    function updateCreateButton() {
      const button = document.getElementById("createButton");
      const allSelected = Object.entries(selections).every(([key, value]) => {
        if (key === "image" || key === "imageBase64") {
          return value !== null;
        }
        // For arrays (multi-select), check if at least one is selected
        if (Array.isArray(value)) {
          return value.length > 0;
        }
        // For single select, check if not null
        return value !== null;
      });
      button.disabled = !allSelected;
    }

    // Build prompt from selections
    function buildPrompt() {
      const parts = formConfig.sections
        .map((section) => {
          const selection = selections[section.id];

          if (Array.isArray(selection)) {
            // Multi-select: get all selected options
            const selectedPrompts = selection
              .map((optionId) => {
                const option = section.options.find(
                  (opt) => opt.id === optionId
                );
                return option?.prompt || "";
              })
              .filter(Boolean);
            return selectedPrompts.join(" ");
          } else {
            // Single select
            const selectedOption = section.options.find(
              (opt) => opt.id === selection
            );
            return selectedOption?.prompt || "";
          }
        })
        .filter(Boolean);

      return `Generate ${parts.join(" ")} without changing the layout of the room`;
    }

    // Show error message
    function showError(message) {
      const errorElement = document.getElementById("errorMessage");
      errorElement.textContent = message;
      errorElement.classList.add("show");
      setTimeout(() => {
        errorElement.classList.remove("show");
      }, 5000);
    }

    // Progress bar management
    let progressInterval = null;
    let currentProgress = 0;

    const progressStages = [
      { max: 25, message: "Analyzing your design..." },
      { max: 50, message: "Generating cabinet layout..." },
      { max: 75, message: "Applying materials and colors..." },
      { max: 95, message: "Finalizing details..." },
    ];

    function startProgressBar() {
      const rightPanel = document.getElementById("rightPanel");
      const progressBar = document.getElementById("progressBarFill");
      const progressPercentage = document.getElementById("progressPercentage");
      const progressStage = document.getElementById("progressStage");

      // Add generating class to hide form and show progress
      rightPanel.classList.add("generating");

      currentProgress = 0;
      progressBar.style.width = "0%";
      progressPercentage.textContent = "0%";
      progressStage.textContent = progressStages[0].message;

      let stageIndex = 0;

      // Clear any existing interval
      if (progressInterval) {
        clearInterval(progressInterval);
      }

      progressInterval = setInterval(() => {
        // Determine speed based on progress
        let increment;
        if (currentProgress < 60) {
          // Fast progress: 0-60% in ~12 seconds (5% per second)
          increment = 5;
        } else if (currentProgress < 85) {
          // Medium progress: 60-85% in ~25 seconds (1% per second)
          increment = 1;
        } else if (currentProgress < 95) {
          // Slow progress: 85-95% in ~20 seconds (0.5% per second)
          increment = 0.5;
        } else {
          // Very slow: stays at 95% until completion
          increment = 0.1;
        }

        currentProgress = Math.min(currentProgress + increment, 95);

        // Update UI
        progressBar.style.width = currentProgress + "%";
        progressPercentage.textContent = Math.round(currentProgress) + "%";

        // Update stage message
        for (let i = 0; i < progressStages.length; i++) {
          if (currentProgress < progressStages[i].max) {
            if (i !== stageIndex) {
              stageIndex = i;
              progressStage.textContent = progressStages[i].message;
            }
            break;
          }
        }

        // Stop at 95% and wait for actual completion
        if (currentProgress >= 95) {
          clearInterval(progressInterval);
          progressStage.textContent = "Almost there...";
        }
      }, 1000); // Update every second
    }

    function completeProgressBar() {
      const progressBar = document.getElementById("progressBarFill");
      const progressPercentage = document.getElementById("progressPercentage");
      const progressStage = document.getElementById("progressStage");

      // Clear interval
      if (progressInterval) {
        clearInterval(progressInterval);
      }

      // Jump to 100%
      currentProgress = 100;
      progressBar.style.width = "100%";
      progressPercentage.textContent = "100%";
      progressStage.textContent = "Complete!";

      // Hide after a brief moment
      setTimeout(() => {
        hideProgressBar();
      }, 500);
    }

    function hideProgressBar() {
      const rightPanel = document.getElementById("rightPanel");
      rightPanel.classList.remove("generating");

      // Reset for next time
      if (progressInterval) {
        clearInterval(progressInterval);
        progressInterval = null;
      }
      currentProgress = 0;
    }

    // Update button state with loading
    function setButtonLoading(isLoading) {
      const button = document.getElementById("createButton");
      if (isLoading) {
        button.disabled = true;
        button.innerHTML = '<span class="loading-spinner"></span>Generating...';
      } else {
        button.disabled = false;
        button.innerHTML = "Create";
        updateCreateButton(); // Revalidate button state
      }
    }

    // Poll for task result
    async function pollTaskResult(taskId, startTime) {
      const maxAttempts = 60; // Poll for up to 5 minutes (60 * 5 seconds)
      let attempts = 0;

      console.log(`[POLLING] Starting to poll for task: ${taskId}`);

      while (attempts < maxAttempts) {
        try {
          const pollStartTime = performance.now();
          const response = await fetch(`${API_BASE_URL}/result/${taskId}`);
          const data = await response.json();
          const pollEndTime = performance.now();

          attempts++;
          const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(2);

          console.log(
            `[POLLING] Attempt ${attempts}/${maxAttempts} (${elapsedTime}s elapsed)`,
            {
              status: data.status,
              responseTime: `${(pollEndTime - pollStartTime).toFixed(2)}ms`,
              data: data,
            }
          );

          if (data.status === "success") {
            console.log(`[SUCCESS] Task completed in ${elapsedTime}s`, {
              imageUrl: data.imageUrl,
              allUrls: data.allUrls,
            });
            return data;
          } else if (data.status === "failed") {
            console.error(`[FAILED] Task failed after ${elapsedTime}s`, {
              error: data.error,
              errorCode: data.errorCode,
            });
            throw new Error(data.error || "Image generation failed");
          }

          // Wait 5 seconds before polling again
          console.log(
            `[POLLING] Status: ${data.status}, waiting 5s before next poll...`
          );
          await new Promise((resolve) => setTimeout(resolve, 5000));
        } catch (error) {
          console.error(`[ERROR] Polling error on attempt ${attempts}:`, error);
          throw error;
        }
      }

      const totalTime = ((Date.now() - startTime) / 1000).toFixed(2);
      console.error(
        `[TIMEOUT] Task timed out after ${totalTime}s (${maxAttempts} attempts)`
      );
      throw new Error("Image generation timed out");
    }

    // Show result modal
    function showResult(imageUrl) {
      const modal = document.getElementById("resultModal");
      const resultImage = document.getElementById("resultImage");
      resultImage.src = imageUrl;
      modal.classList.add("show");
    }

    // Show comparison slider
    function showComparison(originalImageSrc, generatedImageUrl) {
      const container = document.getElementById("comparisonContainer");
      const beforeImage = document.getElementById("beforeImage");
      const afterImage = document.getElementById("afterImage");

      // Set the images - after (generated) is the full background, before (original) is the overlay
      afterImage.src = generatedImageUrl;
      beforeImage.src = originalImageSrc;

      container.classList.add("show");

      // Set the width of the before image to match the slider width after images load
      afterImage.onload = function () {
        const slider = document.getElementById("imageComparisonSlider");
        const imageBefore = document.getElementById("imageBefore");
        const width = slider.offsetWidth;
        const height = afterImage.offsetHeight;

        // Set dimensions on both the container and the image
        beforeImage.style.width = width + "px";
        beforeImage.style.height = height + "px";
        imageBefore.style.height = height + "px";
      };

      // Scroll to comparison section
      setTimeout(() => {
        container.scrollIntoView({ behavior: "smooth", block: "start" });
      }, 100);

      // Store generated URL for download
      container.dataset.generatedUrl = generatedImageUrl;
    }

    // Initialize comparison slider
    function initComparisonSlider() {
      const slider = document.getElementById("imageComparisonSlider");
      const imageBefore = document.getElementById("imageBefore");
      const beforeImage = document.getElementById("beforeImage");
      const resizer = document.getElementById("sliderHandle");
      let active = false;

      // Adjust width of image on resize
      window.addEventListener("resize", function () {
        const afterImage = document.getElementById("afterImage");
        const width = slider.offsetWidth;
        if (beforeImage.src && afterImage.complete) {
          const height = afterImage.offsetHeight;
          beforeImage.style.width = width + "px";
          beforeImage.style.height = height + "px";
          imageBefore.style.height = height + "px";
        }
      });

      function slideIt(x) {
        let transform = Math.max(0, Math.min(x, slider.offsetWidth));
        imageBefore.style.width = transform + "px";
        resizer.style.left = transform + "px";
      }

      function pauseEvent(e) {
        if (e.stopPropagation) e.stopPropagation();
        if (e.preventDefault) e.preventDefault();
        e.cancelBubble = true;
        e.returnValue = false;
        return false;
      }

      // Mouse events
      resizer.addEventListener("mousedown", function () {
        active = true;
        resizer.classList.add("resize");
      });

      document.body.addEventListener("mouseup", function () {
        active = false;
        resizer.classList.remove("resize");
      });

      document.body.addEventListener("mouseleave", function () {
        active = false;
        resizer.classList.remove("resize");
      });

      document.body.addEventListener("mousemove", function (e) {
        if (!active) return;
        let x = e.pageX;
        x -= slider.getBoundingClientRect().left;
        slideIt(x);
        pauseEvent(e);
      });

      // Touch events
      resizer.addEventListener("touchstart", function () {
        active = true;
        resizer.classList.add("resize");
      });

      document.body.addEventListener("touchend", function () {
        active = false;
        resizer.classList.remove("resize");
      });

      document.body.addEventListener("touchcancel", function () {
        active = false;
        resizer.classList.remove("resize");
      });

      document.body.addEventListener("touchmove", function (e) {
        if (!active) return;
        let x;
        let i;
        for (i = 0; i < e.changedTouches.length; i++) {
          x = e.changedTouches[i].pageX;
        }
        x -= slider.getBoundingClientRect().left;
        slideIt(x);
        pauseEvent(e);
      });
    }

    // Close modal handler
    document.getElementById("closeModal").addEventListener("click", () => {
      const modal = document.getElementById("resultModal");
      modal.classList.remove("show");
    });

    // Close modal on background click
    document.getElementById("resultModal").addEventListener("click", (e) => {
      if (e.target.id === "resultModal") {
        e.target.classList.remove("show");
      }
    });

    // Form submission
    document
      .getElementById("cabinetForm")
      .addEventListener("submit", async (e) => {
        e.preventDefault();

        const startTime = Date.now();
        console.log("\n========================================");
        console.log("[START] Form submitted at:", new Date().toISOString());
        console.log("========================================\n");

        const prompt = buildPrompt();

        // Prepare request payload
        const payload = {
          prompt: prompt,
          aspectRatio: "auto", // Default aspect ratio
          resolution: "1K", // Default resolution
          outputFormat: "png", // Default output format
        };

        // Add image if available
        if (selections.imageBase64) {
          payload.imageBase64 = selections.imageBase64;
          console.log(
            `[REQUEST] Image included: ${selections.image.name} (${(
              selections.imageBase64.length / 1024
            ).toFixed(2)} KB)`
          );
        } else {
          console.log("[REQUEST] No image included");
        }

        console.log("\n[REQUEST] Payload Details:");
        console.log("├─ Prompt:", prompt);
        console.log("├─ Aspect Ratio:", payload.aspectRatio);
        console.log("├─ Resolution:", payload.resolution);
        console.log("├─ Output Format:", payload.outputFormat);
        console.log("└─ Has Image:", !!payload.imageBase64);

        console.log("\n[REQUEST] Selected Options:");
        Object.entries(selections).forEach(([key, value]) => {
          if (key === "image" || key === "imageBase64") return;
          const section = formConfig.sections.find((s) => s.id === key);

          if (Array.isArray(value)) {
            // Multi-select
            const optionNames = value
              .map((optionId) => {
                const option = section?.options.find(
                  (opt) => opt.id === optionId
                );
                return option?.name;
              })
              .filter(Boolean)
              .join(", ");
            console.log(`├─ ${section?.label}: [${optionNames}]`);
          } else {
            // Single select
            const option = section?.options.find((opt) => opt.id === value);
            console.log(
              `├─ ${section?.label}: ${option?.name} (${option?.prompt})`
            );
          }
        });

        try {
          // Start progress bar
          startProgressBar();

          // Step 1: Create task
          console.log("\n[API] Creating task...");
          const createStartTime = performance.now();

          const createResponse = await fetch(`${API_BASE_URL}/task`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const createEndTime = performance.now();
          const createDuration = (createEndTime - createStartTime).toFixed(2);

          console.log(
            `[API] Task creation response received in ${createDuration}ms`
          );
          console.log(
            `├─ Status: ${createResponse.status} ${createResponse.statusText}`
          );
          console.log(`└─ OK: ${createResponse.ok}`);

          if (!createResponse.ok) {
            const errorText = await createResponse.text();
            console.error("[API] Error response:", errorText);
            throw new Error(
              `Failed to create task: ${createResponse.statusText}`
            );
          }

          const createData = await createResponse.json();
          const { taskId } = createData;

          console.log(`[API] Task created successfully:`, createData);
          console.log(`└─ Task ID: ${taskId}`);

          // Step 2: Poll for result
          console.log("\n[POLLING] Beginning polling phase...");
          const result = await pollTaskResult(taskId, startTime);

          // Calculate total time
          const totalTime = ((Date.now() - startTime) / 1000).toFixed(2);

          console.log("\n========================================");
          console.log(`[COMPLETE] Total time: ${totalTime}s`);
          console.log("========================================\n");

          // Complete progress bar
          completeProgressBar();

          // Step 3: Show comparison slider
          showComparison(selections.imageBase64, result.imageUrl);
        } catch (error) {
          const errorTime = ((Date.now() - startTime) / 1000).toFixed(2);
          console.error("\n========================================");
          console.error(`[ERROR] Failed after ${errorTime}s`);
          console.error("Error details:", error);
          console.error("Stack trace:", error.stack);
          console.error("========================================\n");

          // Hide progress bar on error
          hideProgressBar();

          showError(
            error.message || "An error occurred while generating the image"
          );
        }
      });

    // Download button handler
    document.getElementById("downloadButton").addEventListener("click", () => {
      const container = document.getElementById("comparisonContainer");
      const imageUrl = container.dataset.generatedUrl;

      if (imageUrl) {
        const link = document.createElement("a");
        link.href = imageUrl;
        link.download = `cabinet-generated-${Date.now()}.png`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    });

    // Reset button handler
    document.getElementById("resetButton").addEventListener("click", () => {
      // Hide comparison container
      const container = document.getElementById("comparisonContainer");
      container.classList.remove("show");

      // Reset form - properly reset arrays and nulls
      Object.keys(selections).forEach((key) => {
        if (Array.isArray(selections[key])) {
          selections[key] = [];
        } else {
          selections[key] = null;
        }
      });

      // Reset UI
      document.querySelectorAll(".option-pill").forEach((pill) => {
        pill.classList.remove("selected");
      });

      document.querySelectorAll(".color-option-wrapper").forEach((wrapper) => {
        wrapper.classList.remove("selected");
        const circle = wrapper.querySelector(".color-circle");
        if (circle) circle.classList.remove("selected");
      });

      // Reset upload area
      const uploadArea = document.getElementById("uploadArea");
      const previewImage = document.getElementById("previewImage");
      const fileInput = document.getElementById("fileInput");

      uploadArea.classList.remove("has-image");
      previewImage.src = "";
      fileInput.value = "";

      updateCreateButton();

      // Scroll back to form
      document.getElementById("cabinet-generator-wrapper").scrollIntoView({
        behavior: "smooth",
        block: "start",
      });
    });

    // Initialize
    renderForm();
    updateCreateButton();
    initComparisonSlider();
  })();
</script>
